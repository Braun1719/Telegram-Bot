# models/questions.py
from dataclasses import dataclass
from typing import List, Dict

@dataclass
class TestQuestion:
    """Базовый класс вопроса теста"""
    id: int
    text: str
    scale: str = None
    reversed: bool = False

class MaslachQuestions:
    """Вопросы опросника Маслач (адаптированные для IT)"""
    
    SCALES = {
        'EE': 'Эмоциональное истощение',
        'DP': 'Деперсонализация', 
        'PA': 'Редукция достижений'
    }
    
    @classmethod
    def get_all(cls) -> List[TestQuestion]:
        return [
            TestQuestion(1, "Я чувствую себя эмоционально опустошенным(ой) после рабочего дня с большим количеством обращений", "EE"),
            TestQuestion(2, "Работа с постоянным потоком тикетов и звонков от пользователей меня эмоционально истощает", "EE"),
            TestQuestion(3, "Я легко понимаю, что чувствуют пользователи, когда обращаются за помощью", "DP", True),
            TestQuestion(4, "Я отношусь к некоторым пользователям как к 'номерам тикетов', а не как к людям с проблемами", "DP"),
            TestQuestion(5, "Я эффективно решаю технические проблемы пользователей, даже самые сложные", "PA", True),
            TestQuestion(6, "Я чувствую себя 'выжатым(ой)' после рабочего дня с постоянными переключениями между задачами", "EE"),
            TestQuestion(7, "Я положительно влияю на работу коллег из других отделов, быстро решая их технические проблемы", "PA", True),
            TestQuestion(8, "Я стал(а) более безразличным(ой) к проблемам и жалобам пользователей", "DP"),
            TestQuestion(9, "Постоянные звонки, чаты и необходимость работать в рамках SLA вызывают у меня стресс", "EE"),
            TestQuestion(10, "Я чувствую удовлетворение, когда могу быстро и качественно помочь пользователю решить его проблему", "PA", True),
        ]
    
    @classmethod
    def get_question(cls, question_id: int) -> TestQuestion:
        questions = cls.get_all()
        if 1 <= question_id <= len(questions):
            return questions[question_id - 1]
        raise ValueError(f"Вопрос с ID {question_id} не найден")

class QuickTestQuestions:
    """Вопросы быстрого теста для IT-специалистов"""
    
    @classmethod
    def get_all(cls) -> List[str]:
        return [
            "Часто ли вы чувствуете усталость даже после выходных?",
            "Раздражают ли вас постоянные митинги и совещания?",
            "Трудно ли концентрироваться на написании кода?",
            "Снизился ли интерес к новым технологиям и фреймворкам?",
            "Беспокоят ли боли в спине или глазах от работы за компьютером?",
            "Стали ли вы более циничным в отношении работы?",
            "Чувствуете ли, что ваш код теряет качество?",
            "Избегаете ли общения с командой?",
            "Работаете ли на автомате, без творческого подхода?",
            "Думали ли о смене компании или профессии?"
        ]
    
    @classmethod
    def get_question(cls, question_id: int) -> str:
        questions = cls.get_all()
        if 1 <= question_id <= len(questions):
            return questions[question_id - 1]
        raise ValueError(f"Вопрос с ID {question_id} не найден")

class BoykoTestQuestions:
    """Опросник эмоционального выгорания Бойко (адаптированный для ИТ-специалистов)"""
    
    @classmethod
    def get_all(cls) -> List[TestQuestion]:
        return [
            # Фаза 1: Напряжение (первые признаки выгорания)
            TestQuestion(1, "Я чувствую себя эмоционально истощенным к концу рабочей недели/спринта", "фаза1"),
            TestQuestion(2, "Мне становится все труднее сосредоточиться на сложных задачах, требующих глубокой концентрации", "фаза1"),
            TestQuestion(3, "Я испытываю раздражение или тревогу при мысли о накопившихся тикетах, задачах в бэклоге или предстоящих дедлайнах", "фаза1"),
            TestQuestion(4, "Я часто ловлю себя на мысли о работе в нерабочее время, по выходным или перед сном", "фаза1"),
            TestQuestion(5, "У меня возникает физическое напряжение (в шее, спине, глазах) от долгой работы за компьютером, которое не проходит после отдыха", "фаза1"),
            
            # Фаза 2: Резистенция (сопротивление, цинизм)
            TestQuestion(6, "Я стал(а) более цинично относиться к целям проекта, новым корпоративным инициативам или постоянным изменениям в процессах", "фаза2"),
            TestQuestion(7, "Меня раздражают просьбы пользователей, коллег из других отделов или членов команды, которые 'отвлекают' от моей основной работы", "фаза2"),
            TestQuestion(8, "Я стал(а) воспринимать коллег или клиентов скорее как источник проблем, чем как часть общей цели", "фаза2"),
            TestQuestion(9, "Я избегаю необязательных митингов, корпоративных мероприятий или неформального общения с командой", "фаза2"),
            TestQuestion(10, "Мне кажется, что мои усилия и expertise не получают должного признания или влияют на результат меньше, чем хотелось бы", "фаза2"),
            
            # Фаза 3: Истощение (эмоциональное и физическое)
            TestQuestion(11, "Я чувствую себя 'выжатым(ой)' и опустошенным(ой) после стандартного рабочего дня, даже если не было авралов", "фаза3"),
            TestQuestion(12, "Меня не радуют успешно завершенные задачи или рабочие победы, которые раньше приносили удовлетворение", "фаза3"),
            TestQuestion(13, "Я выполняю задачи механически, 'на автопилоте', без прежнего интереса к решению нетривиальных проблем", "фаза3"),
            TestQuestion(14, "Я стал(а) чаще допускать досадные ошибки, опечатки или упускать важные детали в своей работе", "фаза3"),
            TestQuestion(15, "У меня пропало желание изучать новые инструменты, технологии или улучшать свои профессиональные навыки", "фаза3"),
            
            # Фаза 4: Деформация (профессиональная деградация)
            TestQuestion(16, "Я ощущаю, что мой профессиональный рост остановился, и я отстаю от трендов в индустрии", "фаза4"),
            TestQuestion(17, "Я сомневаюсь в своей профессиональной компетентности и ценности как специалиста на рынке", "фаза4"),
            TestQuestion(18, "У меня всерьез возникают мысли о том, чтобы уйти из текущей компании, сменить роль внутри ИТ или покинуть индустрию вообще", "фаза4"),
            TestQuestion(19, "Мне кажется, что моя работа потеряла смысл и не приносит реальной пользы", "фаза4"),
            TestQuestion(20, "Я сознательно откладываю или саботирую планы по обучению и профессиональному развитию", "фаза4"),
        ]
    
    @classmethod
    def get_question(cls, question_id: int) -> TestQuestion:
        questions = cls.get_all()
        if 1 <= question_id <= len(questions):
            return questions[question_id - 1]
        raise ValueError(f"Вопрос с ID {question_id} не найден")
    
    @classmethod
    def get_phase_description(cls, phase: str) -> str:
        """Получение описания фазы выгорания по Бойко (адаптировано для ИТ)"""
        descriptions = {
            "фаза1": "Напряжение: нарастающее истощение, трудности с концентрацией, тревога из-за объема работы, физические симптомы.",
            "фаза2": "Резистенция: рост цинизма, раздражение на коллег и процессы, эмоциональное отстранение от работы и команды.",
            "фаза3": "Истощение: стойкая эмоциональная и физическая усталость, потеря удовлетворения от работы, рост числа ошибок.",
            "фаза4": "Деформация: кризис профессиональной идентичности, ощущение стагнации, мысли об уходе, потеря смысла в работе."
        }
        return descriptions.get(phase, "Фаза не определена")
    
    @classmethod
    def get_phase_characteristics(cls, phase: str) -> List[str]:
        """Характеристики фазы для ИТ-специалистов"""
        characteristics = {
            "фаза1": [
                "Хроническая усталость, связанная с умственной нагрузкой",
                "Снижение когнитивных функций (память, концентрация)",
                "Повышенная раздражительность на рабочие процессы",
                "Нарушение графика работы и отдыха",
                "Первые соматические симптомы (напряжение в теле, проблемы со сном)"
            ],
            "фаза2": [
                "Цинизм и сарказм в отношении задач, руководства или изменений",
                "Эмоциональное дистанцирование от пользователей/коллег",
                "Сокращение участия в жизни команды и нетворкинге",
                "Ощущение несправедливости и недооцененности",
                "Повышенная конфликтность или, наоборот, замкнутость"
            ],
            "фаза3": [
                "Чувство опустошенности и профессиональной 'пустоты'",
                "Потеря мотивации и интереса к сложным вызовам",
                "Снижение качества работы, рост числа 'глупых' ошибок",
                "Пренебрежение своим профессиональным развитием",
                "Психосоматические заболевания (головные боли, частые простуды)"
            ],
            "фаза4": [
                "Ощущение профессионального тупика и отставания",
                "Глубокая неуверенность в своих силах и знаниях",
                "Поиск крайних решений (увольнение, смена карьеры)",
                "Экзистенциальный кризис относительно смысла работы",
                "Полный отказ от какой-либо активности, связанной с развитием"
            ]
        }
        return characteristics.get(phase, [])
    
    @classmethod
    def get_it_specific_recommendations(cls, phase: str) -> List[str]:
        """Рекомендации для ИТ-специалистов по фазам"""
        recommendations = {
            "фаза1": [
                "**Технические границы:** Отключайте рабочие уведомления после работы. Используйте отдельный профиль/браузер для работы.",
                "**Управление фокусом:** Внедрите технику Pomodoro (25/5) с обязательными перерывами от экрана. Используйте time-tracking для анализа расхода сил.",
                "**Рабочая среда:** Настройте эргономику рабочего места. Внедрите правила 'глубокой работы' (deep work) в команде.",
                "**Проактивность:** Обсудите с руководителем приоритеты и реалистичность сроков. Научитесь говорить 'нет' новым задачам при перегрузе."
            ],
            "фаза2": [
                "**Пересмотр процессов:** Инициируйте ретроспективу для обсуждения боли команды. Предложите оптимизировать регулярные митинги.",
                "**Профессиональный обмен:** Станьте ментором для junior или примите участие в парном программировании/тестировании.",
                "**Новый контекст:** Участвуйте в хакатонах или создайте пет-проект с новой для себя технологией, без давления дедлайнов.",
                "**Внешний взгляд:** Сходите на митап или конференцию, чтобы 'освежить' взгляд на индустрию и пообщаться с коллегами из других компаний."
            ],
            "фаза3": [
                "**Обязательный перерыв:** Возьмите полноценный отпуск (минимум 2 недели) с полным цифровым детоксом.",
                "**Медицинский чек-ап:** Проверьте зрение, состояние спины, уровень витаминов (особенно D, B12), гормонов стресса.",
                "**Психологическая помощь:** Рассмотрите работу с когнитивно-поведенческим терапевтом (КПТ) или коучем, специализирующимся на выгорании в IT.",
                "**Изменение рутины:** Внедрите регулярную физическую активность, не связанную с компьютером. Попробуйте практики mindfulness или медитации через приложения (Headspace, Calm)."
            ],
            "фаза4": [
                "**Карьерный аудит:** С помощью HR или карьерного коуча проанализируйте свои сильные стороны и интересы. Рассмотрите ротацию внутри компании (другой отдел, проект, роль).",
                "**Саббатикал:** Если возможно, договоритесь о длительном неоплачиваемом отпуске для восстановления и переосмысления карьерных целей.",
                "**Системное обучение:** Запишитесь на долгосрочный курс или программу, которая кардинально расширит ваш стек (например, переход из разработчика в data scientist).",
                "**Поиск миссии:** Попробуйте применить свои навыки в волонтерском или социальном IT-проекте, чтобы заново найти смысл в своей работе."
            ]
        }
        return recommendations.get(phase, [])
    
    @classmethod
    def get_question_text(cls, question_id: int) -> str:
        """Получение только текста вопроса"""
        question = cls.get_question(question_id)
        return question.text
    
    @classmethod
    def get_questions_count_by_phase(cls) -> Dict[str, int]:
        """Количество вопросов по фазам"""
        counts = {"фаза1": 0, "фаза2": 0, "фаза3": 0, "фаза4": 0}
        for question in cls.get_all():
            counts[question.scale] += 1
        return counts

class HeckHessTestQuestions:
    """Тест Хека-Хесса для диагностики депрессивных состояний (адаптированный для ИТ)"""
    
    SCALES = {
        'depression': 'Депрессивные симптомы',
        'burnout': 'Риск выгорания',
        'anxiety': 'Тревожность'
    }
    
    @classmethod
    def get_all(cls) -> List[TestQuestion]:
        """21 вопрос теста Хека-Хесса (с адаптацией для ИТ)"""
        return [
            # Вопросы депрессивного состояния (1-7)
            TestQuestion(1, "Чувствуете ли вы подавленное настроение большую часть дня?", "depression"),
            TestQuestion(2, "Испытываете ли вы снижение интереса к программированию или технологиям?", "depression"),
            TestQuestion(3, "Чувствуете ли вы постоянную усталость и недостаток энергии для работы?", "depression"),
            TestQuestion(4, "Есть ли у вас чувство вины за несделанные задачи или баги в коде?", "depression"),
            TestQuestion(5, "Трудно ли вам концентрироваться на написании кода?", "depression"),
            TestQuestion(6, "Бывают ли у вас мысли о бессмысленности работы в ИТ?", "depression"),
            TestQuestion(7, "Испытываете ли вы беспокойство из-за постоянных изменений в технологиях?", "depression"),
            
            # Вопросы риска выгорания (8-14)
            TestQuestion(8, "Чувствуете ли вы эмоциональное истощение после рабочего дня с кодом?", "burnout"),
            TestQuestion(9, "Стали ли вы более циничным или безразличным к качеству своего кода?", "burnout"),
            TestQuestion(10, "Ощущаете ли вы снижение профессиональной эффективности в работе?", "burnout"),
            TestQuestion(11, "Избегаете ли вы общения с коллегами и командой?", "burnout"),
            TestQuestion(12, "Есть ли у вас физические симптомы (головные боли, проблемы со сном)?", "burnout"),
            TestQuestion(13, "Чувствуете ли вы, что работа не приносит удовлетворения?", "burnout"),
            TestQuestion(14, "Думали ли вы о смене работы или профессии в ИТ?", "burnout"),
            
            # Вопросы тревожности (15-21)
            TestQuestion(15, "Испытываете ли вы напряжение или нервозность перед дедлайнами?", "anxiety"),
            TestQuestion(16, "Беспокоитесь ли вы о качестве кода и возможных багах?", "anxiety"),
            TestQuestion(17, "Трудно ли вам расслабиться после решения сложных технических задач?", "anxiety"),
            TestQuestion(18, "Чувствуете ли вы внутреннее беспокойство о карьерном росте в ИТ?", "anxiety"),
            TestQuestion(19, "Есть ли у вас трудности с засыпанием из-за мыслей о работе?", "anxiety"),
            TestQuestion(20, "Ощущаете ли вы мышечное напряжение от долгой работы за компьютером?", "anxiety"),
            TestQuestion(21, "Чувствуете ли вы, что не успеваете за технологическими изменениями в индустрии?", "anxiety"),
        ]
    
    @classmethod
    def get_question(cls, question_id: int) -> TestQuestion:
        questions = cls.get_all()
        if 1 <= question_id <= len(questions):
            return questions[question_id - 1]
        raise ValueError(f"Вопрос с ID {question_id} не найден")
    
    @classmethod
    def get_question_text(cls, question_id: int) -> str:
        """Получение только текста вопроса"""
        question = cls.get_question(question_id)
        return question.text
    
    @classmethod
    def get_scale_description(cls, scale: str) -> str:
        """Получение описания шкалы теста Хека-Хесса"""
        descriptions = {
            'depression': 'Депрессивные симптомы: отражает уровень подавленности, потери интереса и энергии',
            'burnout': 'Риск выгорания: показывает признаки профессионального истощения и цинизма',
            'anxiety': 'Тревожность: измеряет уровень напряжения и беспокойства на работе'
        }
        return descriptions.get(scale, "Шкала не определена")
    
    @classmethod
    def get_scoring_info(cls) -> Dict[str, Dict]:
        """Информация о баллах и интерпретации"""
        return {
            'depression': {
                'low': (0, 10, "Минимальные депрессивные симптомы"),
                'moderate': (11, 18, "Умеренные симптомы, требует внимания"),
                'high': (19, 27, "Выраженные симптомы, рекомендуется консультация"),
                'severe': (28, 36, "Тяжелые симптомы, требуется помощь специалиста")
            },
            'burnout': {
                'low': (0, 8, "Низкий риск выгорания"),
                'moderate': (9, 16, "Средний риск, профилактика рекомендуется"),
                'high': (17, 24, "Высокий риск, требует вмешательства"),
                'severe': (25, 32, "Критический риск, срочные меры")
            },
            'anxiety': {
                'low': (0, 9, "Минимальная тревожность"),
                'moderate': (10, 17, "Умеренная тревожность"),
                'high': (18, 25, "Высокая тревожность"),
                'severe': (26, 34, "Тяжелая тревожность")
            }
        }